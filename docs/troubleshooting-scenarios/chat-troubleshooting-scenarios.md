# Chat 도메인 트러블슈팅 시나리오

## 발생 가능한 문제 상황들

### 1. 읽지 않은 메시지 수 동시 증가 문제
- **시나리오**: 여러 메시지가 동시에 전송될 때
- **재현 방법**: 동시에 여러 메시지 전송
- **예상 증상**: unreadCount가 부정확하게 증가

### 2. 채팅방 목록 조회 N+1 문제
- **시나리오**: 채팅방 목록 조회 시 각 채팅방의 참여자, 마지막 메시지를 개별 쿼리로 조회
- **재현 방법**: 채팅방 목록 조회 시 로그 확인
- **예상 증상**: 채팅방이 많을수록 쿼리 수 증가

### 3. WebSocket 연결 누수
- **시나리오**: WebSocket 연결 종료 시 연결 리소스 정리 누락
- **재현 방법**: WebSocket 연결 후 연결 종료 시 리소스 확인
- **예상 증상**: 메모리 사용량 증가, 연결 누수

### 4. 메시지 전송 시 참여자 검증 누락
- **시나리오**: 채팅방 참여자가 아닌 사용자가 메시지 전송 시도
- **재현 방법**: 참여자가 아닌 사용자로 메시지 전송 시도
- **예상 증상**: 권한 없이 메시지 전송 가능

### 5. 채팅방 생성 시 중복 생성
- **시나리오**: 1:1 채팅방 생성 시 기존 채팅방 확인 없이 새로 생성
- **재현 방법**: 같은 두 사용자 간 채팅방 여러 번 생성
- **예상 증상**: 중복 채팅방 생성

### 6. 메시지 조회 시 페이징 성능 저하
- **시나리오**: 메시지가 많을 때 페이징 조회 성능 저하
- **재현 방법**: 메시지가 많은 채팅방에서 페이징 조회
- **예상 증상**: 응답 시간 증가

### 7. 채팅방 나가기 시 참여자 수 처리 문제
- **시나리오**: 채팅방 나가기 시 참여자가 없어도 채팅방이 활성 상태로 남음
- **재현 방법**: 마지막 참여자가 나가기
- **예상 증상**: 참여자가 없는 채팅방이 활성 상태로 남음

### 8. 재참여 시 메시지 조회 로직 누락
- **시나리오**: 채팅방 나간 후 재참여 시 이전 메시지도 조회됨
- **재현 방법**: 채팅방 나간 후 재참여 시 메시지 조회
- **예상 증상**: 이전 대화 내용이 보임

