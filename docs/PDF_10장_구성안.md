# Petory 프로젝트 PDF 10장 구성안

## 📄 페이지별 구성

### **1장: 커버 페이지**
- 프로젝트명: **Petory**
- 부제: 반려동물 통합 플랫폼
- 개발자명
- 일자

---

### **2장: 프로젝트 개요**
**내용:**
- 프로젝트 소개
  - 반려동물 통합 플랫폼으로 커뮤니티, 펫케어, 실종 찾기, 위치 서비스 제공
- 프로젝트 목적
  - 기능 구현 이후 성능·동시성 문제를 테스트 기반으로 재현하고 개선하는 프로세스
- 핵심 특징
  - 도메인 주도 설계 (DDD)
  - 레이어드 아키텍처
  - 테스트 기반 성능 최적화

---

### **3장: 시스템 아키텍처**
**내용:**
- 전체 시스템 아키텍처 다이어그램
  - Frontend Layer (React, SSE, WebSocket)
  - API Gateway Layer (Security, Controllers)
  - Service Layer (11개 도메인 서비스)
  - Data Layer (MySQL, Redis)
  - External Services (Naver Map, OAuth, Email)
  - Scheduler Layer

- 레이어드 아키텍처 설명
- 도메인 주도 설계 (DDD) 적용

**비주얼:**
- Mermaid 다이어그램 (색상 구분)
- 레이어별 역할 설명

---

### **4장: 핵심 성과 (종합 지표)**
**내용:**
- **Board 도메인**
  - 쿼리 수: 301개 → 3개 (99% 감소)
  - 실행 시간: 745ms → 30ms (24.83배 개선)
  - 메모리: 22.50 MB → 2 MB (91% 감소)

- **User 도메인**
  - 쿼리 수: 21개 → 4개 (80.95% 감소)
  - 실행 시간: 305ms → 55ms (81.97% 개선)
  - 메모리: 0.58MB → 0.13MB (77.24% 절감)

- **Location 도메인**
  - 초기 로드 데이터: 22,699개 → 1,026개 (95.5% 감소)
  - 프론트엔드 처리: 1,484ms → 700ms (52.8% 개선)
  - 네트워크 전송량: 22 MB → 1 MB (95.5% 감소)

**비주얼:**
- 숫자 중심의 인포그래픽
- Before/After 비교 차트
- 주요 개선율 강조

---

### **5장: 문제 해결 사례 1 - User 도메인 (N+1 문제)**

#### 📋 문제 상황

- 로그인 시 채팅방 목록 조회 과정에서 N+1 문제 발생
- 채팅방 10개 조회 시 참여자, 사용자 정보를 각각 개별 쿼리로 조회
- **총 21개 쿼리** 실행되어 로그인 응답 시간 300ms 이상 소요

#### 🔧 해결 방법

- **배치 조회**: `@BatchSize`로 연관 엔티티를 배치 단위로 조회
- **Fetch Join**: `JOIN FETCH`로 채팅방, 참여자, 사용자 정보를 한 번에 조회
- **메모리 최적화**: Map 자료구조로 변환하여 빠른 접근

#### 📊 개선 결과

| 항목 | Before | After | 개선율 |
|------|--------|-------|--------|
| **쿼리 수** | 21개 | 4개 | 80.95% 감소 |
| **실행 시간** | 305ms | 55ms | 81.97% 개선 |
| **메모리 사용량** | 0.58MB | 0.13MB | 77.24% 절감 |

**상세 분석:**
- 쿼리 수: 21개 → 4개 (배치 조회로 인한 대폭 감소)
- 실행 시간: 305ms → 55ms (5.5배 빠름)
- 메모리: 0.58MB → 0.13MB (불필요한 객체 생성 감소)

#### 🎯 핵심 포인트

- **배치 조회**: `@BatchSize`로 N개를 한 번에 조회
- **Fetch Join**: JOIN FETCH로 연관 엔티티 한 번에 조회
- **메모리 최적화**: Map을 활용한 O(1) 접근

**비주얼:**
- Sequence Diagram (Before/After 비교)
- 쿼리 실행 플로우 비교 차트
- 성능 지표 그래프 (쿼리 수, 실행 시간, 메모리)

---

### **6장: 문제 해결 사례 2 - Board 도메인 (N+1 문제)**

#### 📋 문제 상황

- 게시글 목록 조회 시 작성자, 좋아요/싫어요 정보를 각각 개별 쿼리로 조회
- 100개 게시글 조회 시 **총 301개 쿼리** 발생
- 인기글 계산 시 매번 실시간 계산으로 성능 저하

#### 🔧 해결 방법

- **Fetch Join**: 게시글, 작성자, 반응 정보를 한 번의 쿼리로 조회
- **배치 조회**: `@BatchSize`로 반응 정보를 배치 단위로 조회
- **인기글 스냅샷**: 매일 자정에 인기글 점수를 미리 계산하여 저장

#### 📊 개선 결과

| 항목 | Before | After | 개선율 |
|------|--------|-------|--------|
| **쿼리 수** | 301개 | 3개 | 99.00% 감소 |
| **실행 시간** | 745ms | 30ms | 24.83배 개선 |
| **메모리 사용량** | 22.50 MB | 2 MB | 91% 감소 |

**상세 분석:**
- 쿼리 수: 301개 → 3개 (Fetch Join으로 대폭 감소)
- 실행 시간: 745ms → 30ms (24.83배 빠름)
- 메모리: 22.50 MB → 2 MB (불필요한 객체 생성 제거)
- 인기글 조회: 실시간 계산 → 스냅샷 조회로 변경

#### 🎯 핵심 포인트

- **Fetch Join**: 연관 엔티티를 한 번에 조회
- **배치 조회**: `@BatchSize`로 최적화
- **스냅샷 패턴**: 인기글 점수를 사전 계산하여 저장
- **확장성**: 데이터 증가 시에도 성능 유지

**비주얼:**
- 쿼리 실행 비교 차트 (Before: 301개, After: 3개)
- Fetch Join 전/후 다이어그램
- 인기글 스냅샷 패턴 설명
- 성능 지표 그래프

---

### **7장: 문제 해결 사례 3 - Location 도메인 (초기 로드 최적화)**

#### 📋 문제 상황

- 위치 서비스 초기 로드 시 전체 22,699개 데이터 조회
- 실제로는 주변 10km 이내 최대 100개만 표시하는데 전체 데이터 전송
- 네트워크 전송량 22 MB, 프론트엔드 처리 시간 1,484ms 소요

#### 🔧 해결 방법

- **위치 기반 반경 검색**: `ST_Distance_Sphere`로 사용자 위치 기준 5km 이내만 조회
- **하이브리드 로딩**: 초기 로드는 반경 검색, 이후 검색은 시군구 단위 검색으로 전환
- **시군구 기반 검색**: 지도 이동 시에도 일관성 있는 결과 제공, 쿼리 시간 5-6배 단축

#### 📊 개선 결과

**1단계 개선: 위치 기반 초기 로드 적용**

| 항목 | Before | After | 개선율 |
|------|--------|-------|--------|
| **조회 데이터 수** | 22,699개 | 1,026개 | 95.5% 감소 |
| **프론트엔드 처리** | 1,484ms | 700ms | 52.8% 개선 |
| **네트워크 전송량** | 22 MB | 1 MB | 95.5% 감소 |
| **메모리 사용량** | 78.90 MB | 28.6 MB | 63.8% 감소 |

**2단계 개선: 시군구 기반 검색 전략 적용**

| 항목 | 위치 기반 검색 | 시군구 기반 검색 | 개선율 |
|------|---------------|----------------|--------|
| **쿼리 실행 시간** | 198-368ms | 36-53ms | 5-6배 빠름 |
| **일관성** | 낮음 (지도 이동 시 변동) | 높음 (지역 단위 고정) | - |
| **확장성** | 제한적 | 우수 (인덱싱 활용) | - |

**상세 분석:**
- 초기 로드 데이터: 22,699개 → 1,026개 (95.5% 감소)
- 프론트엔드 처리: 1,484ms → 700ms (2.1배 빠름)
- 네트워크: 22 MB → 1 MB (95.5% 감소)
- 쿼리 실행: 198-368ms → 36-53ms (5-6배 빠름)

#### 🎯 핵심 포인트

- **ST_Distance_Sphere**: MySQL 공간 함수로 정확한 거리 계산
- **하이브리드 로딩**: 초기 로드는 위치 기반, 이후는 시군구 기반
- **일관성 확보**: 지도 이동 시에도 검색 결과 일관성 유지
- **확장성**: 인덱싱을 통한 지역 단위 검색 최적화

**비주얼:**
- 반경 검색 개념도 (ST_Distance_Sphere 시각화)
- 하이브리드 로딩 전략 플로우 (초기 로드 vs 검색)
- 성능 지표 비교 차트 (Before/After)
- 시군구 기반 검색 vs 위치 기반 검색 비교

---

### **8장: 문제 해결 사례 4 - Meetup 도메인 (동시성 제어)**

#### 📋 문제 상황

- 모임 최대 인원 3명인데, 동시에 3명이 참가 버튼 클릭
- 모두 인원 체크를 통과하여 4명 참가되는 Race Condition 발생
- 인원 체크와 증가 사이에 다른 트랜잭션이 끼어들어 Lost Update 발생

#### 🔧 해결 방법

- **원자적 UPDATE 쿼리**: WHERE 절에 인원 체크 조건을 포함하여 DB 레벨에서 원자적으로 처리
- **DB 제약조건**: CHECK 제약조건으로 `current_participants <= max_participants` 검증
- **이벤트 기반 아키텍처**: 모임 생성과 채팅방 생성을 분리하여 핵심 도메인 안정성 확보

#### 📊 개선 결과

| 항목 | Before | After | 개선 |
|------|--------|-------|------|
| **Lost Update** | ✅ 발생 (4명 참가) | ❌ 해결 (3명 참가) | 완전 해결 |
| **인원 초과** | ✅ 발생 | ❌ 해결 | 완전 해결 |
| **데이터 일치** | ❌ 불일치 | ✅ 일치 | 정합성 확보 |
| **데드락 위험** | 높음 (Pessimistic Lock 시) | 없음 | 안정성 향상 |
| **성능** | 낮음 (Lock 대기) | 높음 (병렬 처리) | 성능 최적화 |

**테스트 결과:**
- **Before**: 3명 성공, 0명 실패 → 실제 4명 참가 (최대 3명 초과)
- **After**: 2명 성공, 1명 실패 → 실제 3명 참가 (정상)

**추가 개선:**
- 핵심 도메인과 파생 도메인 분리로 모임 생성 안정성 확보
- 채팅방 생성 실패 시에도 모임은 유지 (사용자 경험 개선)

#### 🎯 핵심 포인트

- **원자적 UPDATE 쿼리**: 조건 체크와 증가를 DB 레벨에서 원자적으로 처리
- **DB 제약조건**: 최종 안전망으로 데이터 무결성 보장
- **이벤트 기반 아키텍처**: 핵심 도메인과 파생 도메인 분리
- **프로젝트 일관성**: 다른 도메인과 동일한 패턴 적용

**비주얼:**
- 동시성 문제 시나리오 다이어그램 (Race Condition 발생 과정)
- 원자적 UPDATE 쿼리 vs 일반 UPDATE 비교
- Before/After 테스트 결과 비교
- 이벤트 기반 아키텍처 플로우

---

### **9장: 기술 스택 & 주요 기능**
**내용:**
- **기술 스택**
  - Backend: Spring Boot 3.x, Java 17+, JPA, Security, WebSocket
  - Frontend: React, Styled-components, Recharts
  - Database: MySQL 8.0, Redis
  - External: Naver Map API, OAuth2, SMTP

- **주요 기능 요약**
  - 7개 핵심 도메인 (User, Board, Care, Location, MissingPet, Meetup, Chat)
  - 5개 지원 도메인 (Notification, Report, File, Activity, Statistics)
  - 실시간 채팅 (WebSocket), 알림 (SSE), 인기글 스냅샷

**비주얼:**
- 기술 스택 로고/아이콘
- 도메인 구조도
- 기능 아이콘 그리드

---

### **10장: 마무리 & 연락처**
**내용:**
- 프로젝트 핵심 가치
  - 테스트 기반 성능 최적화 프로세스
  - 도메인 주도 설계 적용
  - 실제 문제 해결 경험

- 관련 링크
  - GitHub 저장소
  - Live Demo
  - 포트폴리오 사이트

- 연락처
  - 이메일
  - GitHub

**비주얼:**
- 프로젝트 핵심 가치 아이콘
- 간단한 차트/요약 (선택)

---


