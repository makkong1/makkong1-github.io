# 주변서비스 리팩토링 테스트 시나리오

**작성일**: 2026-02-03  
**테스트 대상**: 거리 계산 중복 제거 + 프론트엔드 검색 로직 단순화

---

## 📋 테스트 개요

### 수정 사항

1. **백엔드**: 위치 기반 검색 시 거리 정보를 DTO에 포함하여 반환
2. **프론트엔드**: 검색 로직을 전략별 함수로 분리

### 테스트 방법

- **수동 테스트**: 브라우저에서 직접 확인
- **API 테스트**: Postman/Thunder Client로 백엔드 확인
- **콘솔 로그 확인**: 브라우저 개발자 도구에서 확인

---

## 🔍 백엔드 테스트

### 테스트 1: 위치 기반 검색 - 거리 정보 포함 확인

**API 엔드포인트**:
```
GET http://localhost:8080/api/location-services/search?latitude=37.5665&longitude=126.9780&radius=5000
```

**예상 응답**:
```json
{
  "services": [
    {
      "idx": 1,
      "name": "서울 동물병원",
      "latitude": 37.5670,
      "longitude": 126.9785,
      "distance": 123.45,  // ✅ 거리 정보 포함 확인
      ...
    }
  ],
  "count": 10
}
```

**확인 사항**:
- [ ] 모든 서비스에 `distance` 필드가 포함되어 있는지
- [ ] `distance` 값이 숫자(미터 단위)인지
- [ ] `distance` 값이 `radius` 이하인지
- [ ] 거리순으로 정렬되어 있는지 (선택적)

**테스트 도구**:
- Postman
- Thunder Client (VS Code 확장)
- curl 명령어

**curl 예시**:
```bash
curl "http://localhost:8080/api/location-services/search?latitude=37.5665&longitude=126.9780&radius=5000" | jq '.services[0].distance'
```

---

### 테스트 2: 거리 계산 정확도 확인

**테스트 방법**:
1. 알려진 두 좌표 간 거리 계산
2. 백엔드 응답의 `distance` 값과 비교

**테스트 케이스**:
```
위치1: 서울시청 (37.5665, 126.9780)
위치2: 명동 (37.5636, 126.9827)
예상 거리: 약 500m
```

**API 호출**:
```
GET http://localhost:8080/api/location-services/search?latitude=37.5665&longitude=126.9780&radius=1000
```

**확인 사항**:
- [ ] `distance` 값이 예상 범위 내인지 (예: 450m ~ 550m)
- [ ] 여러 서비스의 거리가 일관되게 계산되는지

---

### 테스트 3: 카테고리 필터링 + 거리 정보 확인

**API 엔드포인트**:
```
GET http://localhost:8080/api/location-services/search?latitude=37.5665&longitude=126.9780&radius=5000&category=동물병원
```

**확인 사항**:
- [ ] 카테고리 필터링이 정상 작동하는지
- [ ] 필터링된 결과에도 `distance` 정보가 포함되는지
- [ ] 거리 정보가 올바르게 계산되는지

---

## 🖥️ 프론트엔드 테스트

### 테스트 1: 초기 로드 - 거리 정보 사용 확인

**테스트 시나리오**:
1. 브라우저에서 주변서비스 페이지 접속
2. 위치 권한 허용
3. 개발자 도구 콘솔 열기

**확인 사항**:
- [ ] 초기 로드 시 API 응답에 `distance` 필드가 있는지
- [ ] 프론트엔드에서 거리 계산을 수행하지 않는지 (콘솔 로그 확인)
- [ ] 거리 정보가 올바르게 표시되는지

**콘솔 로그 확인**:
```javascript
// 네트워크 탭에서 API 응답 확인
// 또는 콘솔에서:
console.log('서비스 거리 정보:', services[0].distance);
```

---

### 테스트 2: 위치 기반 검색 - 각 전략 함수 동작 확인

**테스트 시나리오**:
1. 지도에서 다른 위치로 이동
2. "이 지역 검색" 버튼 클릭
3. 개발자 도구 콘솔 확인

**확인 사항**:
- [ ] `handleLocationBasedSearch` 함수가 호출되는지
- [ ] API 응답에 `distance` 정보가 있는지
- [ ] 프론트엔드에서 거리 재계산을 하지 않는지

**콘솔 로그 확인**:
```
📍 [위치 기반 검색] API 호출: {latitude: ..., longitude: ..., radius: ...}
📍 [위치 기반 검색] 결과: N개 서비스
```

---

### 테스트 3: 지역 검색 - 전략 함수 분리 확인

**테스트 시나리오**:
1. 지역 선택 UI에서 시도 선택 (예: "서울특별시")
2. 시군구 선택 (예: "노원구")
3. 개발자 도구 콘솔 확인

**확인 사항**:
- [ ] `executeRegionSearchStrategy` 함수가 호출되는지
- [ ] 지역 검색이 정상 작동하는지
- [ ] 검색 결과가 올바르게 표시되는지

**콘솔 로그 확인**:
```
🌐 [하이브리드] 현재 데이터 범위 밖 - 백엔드 재요청
또는
📍 [하이브리드] 현재 데이터 범위 내 - 프론트엔드 필터링
```

---

### 테스트 4: 하이브리드 전략 동작 확인

**테스트 시나리오**:
1. 초기 로드 완료 후 (데이터가 로드된 상태)
2. 같은 시도 내 다른 시군구 선택
3. 다른 시도 선택

**확인 사항**:
- [ ] 데이터 범위 내: 프론트엔드 필터링만 수행
- [ ] 데이터 범위 밖: 백엔드 재요청 수행
- [ ] `handleHybridSearch` 함수가 올바르게 동작하는지

---

### 테스트 5: 검색 전략 함수 분리 확인

**테스트 시나리오**:
각 검색 시나리오를 실행하고 개발자 도구에서 함수 호출 확인

**확인 방법**:
1. 개발자 도구 → Sources 탭
2. `LocationServiceMap.js` 파일 열기
3. 각 전략 함수에 브레이크포인트 설정
4. 각 검색 시나리오 실행

**확인 사항**:
- [ ] `handleInitialLoad`: 초기 로드 시 호출
- [ ] `handleLocationBasedSearch`: 위치 기반 검색 시 호출
- [ ] `executeRegionSearchStrategy`: 지역 검색 시 호출
- [ ] `handleHybridSearch`: 하이브리드 전략 시 호출

---

## 📊 성능 테스트

### 테스트 1: 거리 계산 성능 비교

**Before (이전)**:
- 백엔드: 반경 필터링만
- 프론트엔드: 각 서비스마다 거리 계산

**After (개선 후)**:
- 백엔드: 거리 계산 후 DTO에 포함
- 프론트엔드: 거리 정보 사용 (계산 없음)

**측정 방법**:
1. 개발자 도구 → Performance 탭
2. 초기 로드 실행
3. 성능 프로파일 확인

**확인 사항**:
- [ ] 프론트엔드에서 거리 계산 시간이 감소했는지
- [ ] 전체 로딩 시간이 개선되었는지

---

### 테스트 2: 검색 로직 실행 시간

**측정 방법**:
콘솔 로그에서 성능 측정 메시지 확인

**확인 로그**:
```
⏱️  [성능 측정] API 호출 시간: XXms
⏱️  [성능 측정] 필터링 시간: XXms
✅ [성능 측정] 전체 처리 시간: XXms
```

**확인 사항**:
- [ ] 각 전략별 실행 시간이 합리적인지
- [ ] 리팩토링 전/후 성능 차이가 없는지 (또는 개선되었는지)

---

## 🐛 버그 확인

### 확인 사항

1. **거리 정보 누락**:
   - [ ] 모든 위치 기반 검색 결과에 `distance` 필드가 있는지
   - [ ] `distance`가 `null`인 경우가 있는지

2. **검색 전략 오작동**:
   - [ ] 잘못된 전략이 호출되는 경우가 있는지
   - [ ] 검색 결과가 예상과 다른 경우가 있는지

3. **에러 처리**:
   - [ ] API 에러 시 적절한 에러 메시지 표시
   - [ ] 네트워크 에러 시 처리

---

## ✅ 체크리스트

### 백엔드 테스트
- [ ] 위치 기반 검색 시 거리 정보 포함 확인
- [ ] 거리 계산 정확도 확인
- [ ] 카테고리 필터링 + 거리 정보 확인

### 프론트엔드 테스트
- [ ] 초기 로드 - 거리 정보 사용 확인
- [ ] 위치 기반 검색 - 각 전략 함수 동작 확인
- [ ] 지역 검색 - 전략 함수 분리 확인
- [ ] 하이브리드 전략 동작 확인
- [ ] 검색 전략 함수 분리 확인

### 성능 테스트
- [ ] 거리 계산 성능 비교
- [ ] 검색 로직 실행 시간 확인

### 버그 확인
- [ ] 거리 정보 누락 확인
- [ ] 검색 전략 오작동 확인
- [ ] 에러 처리 확인

---

## 🚀 빠른 테스트 방법

### 1. 백엔드 빠른 확인 (curl)

```bash
# 위치 기반 검색 - 거리 정보 확인
curl "http://localhost:8080/api/location-services/search?latitude=37.5665&longitude=126.9780&radius=5000" \
  | jq '.services[0] | {name, distance}'

# 예상 출력:
# {
#   "name": "서울 동물병원",
#   "distance": 123.45
# }
```

### 2. 프론트엔드 빠른 확인 (브라우저 콘솔)

```javascript
// 1. 네트워크 탭에서 API 응답 확인
// 2. 콘솔에서:
const response = await fetch('http://localhost:8080/api/location-services/search?latitude=37.5665&longitude=126.9780&radius=5000');
const data = await response.json();
console.log('거리 정보 포함:', data.services[0].distance !== undefined);
console.log('거리 값:', data.services[0].distance);
```

### 3. 함수 호출 확인 (브라우저 콘솔)

```javascript
// 개발자 도구 → Sources → LocationServiceMap.js
// 각 전략 함수에 console.log 추가하여 호출 확인
```

---

## 📝 테스트 결과 기록

### 테스트 환경
- **날짜**: 2026-02-03
- **브라우저**: Chrome / Firefox / Safari
- **백엔드**: Spring Boot (포트 8080)
- **프론트엔드**: React (포트 3000)

### 테스트 결과

| 테스트 항목 | 결과 | 비고 |
|------------|------|------|
| 백엔드 거리 정보 포함 | ⏳ | |
| 프론트엔드 거리 정보 사용 | ⏳ | |
| 검색 전략 함수 분리 | ⏳ | |
| 성능 개선 | ⏳ | |

---

**테스트 완료 후**: 결과를 기록하고 문제가 있으면 이슈로 등록
