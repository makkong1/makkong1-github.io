# 관리자 통계 시스템 전략

## 📋 개요
Petory 서비스의 운영 현황을 한눈에 파악하기 위한 관리자 대시보드용 통계 시스템입니다.
실시간으로 무거운 쿼리를 돌리는 대신, **일별 요약 데이터(Daily Statistics)**를 미리 집계하여 저장하는 방식을 사용합니다.

---

## 💾 DB 스키마 전략

### `DailyStatistics` 테이블
매일 발생한 주요 지표를 날짜별로 1행씩 저장합니다.

```sql
CREATE TABLE DailyStatistics (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    stat_date DATE UNIQUE NOT NULL,          -- 통계 날짜 (Unique Index)

    new_users INT DEFAULT 0,                 -- 신규 가입자 수
    new_posts INT DEFAULT 0,                 -- 새 게시글 수 (커뮤니티)
    new_care_requests INT DEFAULT 0,         -- 새 케어 요청 수
    completed_cares INT DEFAULT 0,           -- 완료된 케어 수
    total_revenue DECIMAL(15, 2) DEFAULT 0,  -- 일 매출 (예상)
    active_users INT DEFAULT 0,              -- 일일 활성 사용자 (DAU)

    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
```

---

## 🔄 데이터 집계 전략 (Aggregation Strategy)

### 1. 배치 처리 (Batch Processing) - *권장*
- **주기**: 매일 밤 00:05 (자정 직후)
- **대상**: 전날(`Yesterday`) 00:00 ~ 23:59 데이터
- **로직**:
  1. `Users` 테이블에서 `created_at`이 어제인 카운트 조회 -> `new_users`
  2. `Board` 테이블에서 `created_at`이 어제인 카운트 조회 -> `new_posts`
  3. `CareRequest` 테이블에서 `created_at`이 어제인 카운트 조회 -> `new_care_requests`
  4. ... (나머지 지표 동일)
  5. `DailyStatistics` 테이블에 `INSERT`

### 2. 실시간 보정 (Optional)
- 오늘(`Today`) 데이터는 아직 집계가 안 끝났으므로, 대시보드 요청 시 실시간 `COUNT(*)` 쿼리로 조회하여 보여주거나,
- 혹은 1시간 단위로 배치를 돌려 `DailyStatistics`를 `UPDATE` 하는 방식을 사용할 수 있습니다.
- *현재 구현*: 프론트엔드에서는 조회 시점 기준 저장된 통계 데이터를 불러옵니다. 오늘 데이터는 실시간 쿼리 API를 별도로 두거나, 다음날 확인하는 정책을 가져갑니다.

---

## 📡 API 엔드포인트

### 일별 통계 조회
```http
GET /api/admin/statistics/daily?startDate={yyyy-MM-dd}&endDate={yyyy-MM-dd}
```
- **설명**: 지정된 기간의 일별 통계 데이터를 리스트로 반환합니다.
- **파라미터**:
  - `startDate`: 조회 시작일 (기본값: 30일 전)
  - `endDate`: 조회 종료일 (기본값: 오늘)
- **응답 예시**:
```json
[
  {
    "statDate": "2023-11-19",
    "newUsers": 15,
    "newPosts": 42,
    "newCareRequests": 8,
    "activeUsers": 1240,
    ...
  },
  ...
]
```

---

## 📊 프론트엔드 시각화 전략

### 1. 핵심 지표 요약 (Scorecards)
- 가장 최근(어제/오늘) 데이터를 카드 형태로 표시
- 전일 대비 증감률 표시 (예: 🔺 10%)

### 2. 트렌드 차트 (Line Chart)
- X축: 날짜 (`statDate`)
- Y축: 가입자 수, 활성 유저 수 등
- 목적: 서비스 성장 추세 확인

### 3. 활성화 차트 (Bar/Stacked Chart)
- X축: 날짜
- Y축: 게시글 수 + 케어 요청 수
- 목적: 커뮤니티와 서비스 이용 비율 확인
