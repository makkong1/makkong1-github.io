# ì‹ ê³  ë° ì œì¬ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

## ğŸ“‹ ê°œìš”

ì‹ ê³  ë° ì œì¬ ì‹œìŠ¤í…œì€ Petory ì„œë¹„ìŠ¤ì˜ ìœ í•´ ì½˜í…ì¸ ì™€ ë¶€ì ì ˆí•œ ì‚¬ìš©ìë¥¼ ê´€ë¦¬í•˜ê¸° ìœ„í•œ í•µì‹¬ ê¸°ëŠ¥ì…ë‹ˆë‹¤. ë‹¤ì–‘í•œ ì‹ ê³  íƒ€ì…ì„ ì§€ì›í•˜ë©°, ê²½ê³  ëˆ„ì  ì‹œ ìë™ ì œì¬ë¥¼ ì ìš©í•˜ê³ , ê´€ë¦¬ìì˜ ìˆ˜ë™ ì œì¬ì™€ ìŠ¤ì¼€ì¤„ëŸ¬ë¥¼ í†µí•œ ìë™ í•´ì œë¥¼ ì œê³µí•©ë‹ˆë‹¤. ë™ì‹œì„± ì œì–´ë¥¼ í†µí•´ ì—¬ëŸ¬ ê´€ë¦¬ìê°€ ë™ì‹œì— ê²½ê³ ë¥¼ ë¶€ì—¬í•´ë„ ì •í™•í•œ ê²½ê³  íšŸìˆ˜ë¥¼ ë³´ì¥í•©ë‹ˆë‹¤.

## ğŸ—ï¸ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

### ì „ì²´ êµ¬ì¡°ë„

```mermaid
graph TB
    subgraph "Frontend"
        User[ì‚¬ìš©ì]
        Admin[ê´€ë¦¬ì]
    end
    
    subgraph "Backend API Layer"
        RC[ReportController<br/>/api/reports]
        AC[Admin Controllers<br/>ì‹ ê³  ì²˜ë¦¬]
    end
    
    subgraph "Service Layer"
        RS[ReportService<br/>ì‹ ê³  ìƒì„±, ì²˜ë¦¬]
        USS[UserSanctionService<br/>ì œì¬ ì ìš©, í•´ì œ]
    end
    
    subgraph "Scheduler"
        USSCH[UserSanctionScheduler<br/>ë§Œë£Œëœ ì œì¬ ìë™ í•´ì œ]
    end
    
    subgraph "Data Layer"
        RR[ReportRepository]
        USR[UserSanctionRepository]
        UR[UsersRepository]
        MySQL[(MySQL<br/>report<br/>user_sanctions<br/>users)]
    end
    
    subgraph "Domain Targets"
        Board[Board<br/>ê²Œì‹œê¸€]
        Comment[Comment<br/>ëŒ“ê¸€]
        MissingPet[MissingPetBoard<br/>ì‹¤ì¢… ì œë³´]
        Provider[Users<br/>ì„œë¹„ìŠ¤ ì œê³µì]
    end
    
    User --> RC
    Admin --> AC
    Admin --> RC
    
    RC --> RS
    AC --> RS
    AC --> USS
    
    RS --> RR
    RS --> USS
    USS --> USR
    USS --> UR
    
    USSCH --> USS
    
    RR --> MySQL
    USR --> MySQL
    UR --> MySQL
    
    RS --> Board
    RS --> Comment
    RS --> MissingPet
    RS --> Provider
    
    style RS fill:#e1f5ff
    style USS fill:#fff4e1
    style USSCH fill:#ffe1f5
```

## ğŸ”§ í•µì‹¬ ì»´í¬ë„ŒíŠ¸

### 1. ReportService (ì‹ ê³  ì„œë¹„ìŠ¤)

**ì—­í• **: ì‹ ê³  ìƒì„±, ì¡°íšŒ, ì²˜ë¦¬, ì œì¬ ìë™ ì ìš©

**ì£¼ìš” ë©”ì„œë“œ**:
- `createReport()`: ì‹ ê³  ìƒì„± (ì¤‘ë³µ ë°©ì§€)
- `getReports()`: ì‹ ê³  ëª©ë¡ ì¡°íšŒ (í•„í„°ë§ ì§€ì›)
- `getReportDetail()`: ì‹ ê³  ìƒì„¸ ì¡°íšŒ (ëŒ€ìƒ ë¯¸ë¦¬ë³´ê¸° í¬í•¨)
- `handleReport()`: ì‹ ê³  ì²˜ë¦¬ ë° ì œì¬ ìë™ ì ìš©

**í•µì‹¬ ë¡œì§**:

#### ì‹ ê³  ìƒì„±
```java
@Transactional
public ReportDTO createReport(ReportRequestDTO request) {
    // 1. ì…ë ¥ ê²€ì¦
    if (request.getTargetType() == null) {
        throw new IllegalArgumentException("ì‹ ê³  ëŒ€ìƒ ì¢…ë¥˜ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.");
    }
    if (request.getTargetIdx() == null) {
        throw new IllegalArgumentException("ì‹ ê³  ëŒ€ìƒ IDê°€ í•„ìš”í•©ë‹ˆë‹¤.");
    }
    if (!StringUtils.hasText(request.getReason())) {
        throw new IllegalArgumentException("ì‹ ê³  ì‚¬ìœ ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
    }
    
    // 2. ì‹ ê³  ëŒ€ìƒ ê²€ì¦
    validateTarget(request.getTargetType(), request.getTargetIdx());
    
    // 3. ì¤‘ë³µ ì‹ ê³  ë°©ì§€ (DB Unique Constraint)
    if (reportRepository.existsByTargetTypeAndTargetIdxAndReporterIdx(
            request.getTargetType(),
            request.getTargetIdx(),
            reporter.getIdx())) {
        throw new IllegalStateException("ì´ë¯¸ í•´ë‹¹ ëŒ€ìƒì„ ì‹ ê³ í•˜ì…¨ìŠµë‹ˆë‹¤.");
    }
    
    // 4. ì‹ ê³  ìƒì„±
    Report report = Report.builder()
        .targetType(request.getTargetType())
        .targetIdx(request.getTargetIdx())
        .reporter(reporter)
        .reason(request.getReason().trim())
        .status(ReportStatus.PENDING)
        .build();
    
    return reportConverter.toDTO(reportRepository.save(report));
}
```

#### ì‹ ê³  ì²˜ë¦¬ ë° ì œì¬ ìë™ ì ìš©
```java
@Transactional
public ReportDTO handleReport(Long reportId, Long adminUserId, ReportHandleRequest req) {
    Report report = reportRepository.findById(reportId)
        .orElseThrow(() -> new IllegalArgumentException("ì‹ ê³  ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."));
    Users admin = usersRepository.findById(adminUserId)
        .orElseThrow(() -> new IllegalArgumentException("ê´€ë¦¬ì ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."));
    
    // 1. ì‹ ê³  ìƒíƒœ ì—…ë°ì´íŠ¸
    report.setStatus(req.getStatus());
    report.setHandledBy(admin);
    report.setHandledAt(LocalDateTime.now());
    report.setAdminNote(req.getAdminNote());
    report.setActionTaken(req.getActionTaken() != null ? req.getActionTaken() : ReportActionType.NONE);
    
    // 2. ì œì¬ ì¡°ì¹˜ê°€ ìˆìœ¼ë©´ ìë™ ì ìš©
    if (req.getActionTaken() != null &&
            (req.getActionTaken() == ReportActionType.WARN_USER ||
             req.getActionTaken() == ReportActionType.SUSPEND_USER)) {
        String sanctionReason = String.format("ì‹ ê³  #%d ì²˜ë¦¬: %s", reportId,
                req.getAdminNote() != null ? req.getAdminNote() : report.getReason());
        userSanctionService.applySanctionFromReport(
                report.getTargetIdx(),
                req.getActionTaken(),
                sanctionReason,
                admin.getIdx(),
                reportId);
    }
    
    return reportConverter.toDTO(report);
}
```

### 2. UserSanctionService (ì œì¬ ì„œë¹„ìŠ¤)

**ì—­í• **: ì œì¬ ì ìš©, í•´ì œ, ìë™ ì œì¬ ë¡œì§

**ì£¼ìš” ë©”ì„œë“œ**:
- `addWarning()`: ê²½ê³  ì¶”ê°€ (ê²½ê³  3íšŒ ëˆ„ì  ì‹œ ìë™ ì´ìš©ì œí•œ)
- `addSuspension()`: ì´ìš©ì œí•œ ì¶”ê°€ (ì¼ì‹œì )
- `addBan()`: ì˜êµ¬ ì°¨ë‹¨
- `releaseSanction()`: ì œì¬ í•´ì œ (ê´€ë¦¬ì ìˆ˜ë™)
- `releaseExpiredSuspensions()`: ë§Œë£Œëœ ì´ìš©ì œí•œ ìë™ í•´ì œ
- `applySanctionFromReport()`: ì‹ ê³  ì²˜ë¦¬ ì‹œ ìë™ ì œì¬ ì ìš©

**í•µì‹¬ ë¡œì§**:

#### ê²½ê³  ì¶”ê°€ ë° ìë™ ì´ìš©ì œí•œ
```java
@Transactional
public UserSanction addWarning(Long userId, String reason, Long adminId, Long reportId) {
    Users user = usersRepository.findById(userId)
        .orElseThrow(() -> new IllegalArgumentException("ìœ ì €ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."));
    
    // 1. ê²½ê³  ì¶”ê°€
    UserSanction warning = UserSanction.builder()
        .user(user)
        .sanctionType(UserSanction.SanctionType.WARNING)
        .reason(reason)
        .durationDays(null) // ê²½ê³ ëŠ” ê¸°ê°„ ì—†ìŒ
        .startsAt(LocalDateTime.now())
        .endsAt(null)
        .admin(admin)
        .reportIdx(reportId)
        .build();
    
    sanctionRepository.save(warning);
    
    // 2. ê²½ê³  íšŸìˆ˜ ì›ìì  ì¦ê°€ (ë™ì‹œì„± ë¬¸ì œ í•´ê²°)
    usersRepository.incrementWarningCount(userId);
    
    // 3. ì—…ë°ì´íŠ¸ëœ ì‚¬ìš©ì ì •ë³´ ë‹¤ì‹œ ì¡°íšŒ
    user = usersRepository.findById(userId)
        .orElseThrow(() -> new IllegalArgumentException("ìœ ì €ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."));
    
    // 4. ê²½ê³  3íšŒ ì´ìƒì´ë©´ ìë™ ì´ìš©ì œí•œ
    if (user.getWarningCount() >= WARNING_THRESHOLD) {
        log.info("ìœ ì € {} ê²½ê³  {}íšŒ ë„ë‹¬, ìë™ ì´ìš©ì œí•œ {}ì¼ ì ìš©", 
            userId, user.getWarningCount(), AUTO_SUSPENSION_DAYS);
        addSuspension(userId,
            String.format("ê²½ê³  %díšŒ ëˆ„ì ìœ¼ë¡œ ì¸í•œ ìë™ ì´ìš©ì œí•œ", user.getWarningCount()),
            adminId,
            reportId,
            AUTO_SUSPENSION_DAYS);
    }
    
    return warning;
}
```

#### ì´ìš©ì œí•œ ì¶”ê°€
```java
@Transactional
public UserSanction addSuspension(Long userId, String reason, Long adminId, Long reportId, int days) {
    Users user = usersRepository.findById(userId)
        .orElseThrow(() -> new IllegalArgumentException("ìœ ì €ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."));
    
    LocalDateTime now = LocalDateTime.now();
    LocalDateTime endsAt = now.plusDays(days);
    
    // 1. ì´ìš©ì œí•œ ì¶”ê°€
    UserSanction suspension = UserSanction.builder()
        .user(user)
        .sanctionType(UserSanction.SanctionType.SUSPENSION)
        .reason(reason)
        .durationDays(days)
        .startsAt(now)
        .endsAt(endsAt)
        .admin(admin)
        .reportIdx(reportId)
        .build();
    
    sanctionRepository.save(suspension);
    
    // 2. ìœ ì € ìƒíƒœ ì—…ë°ì´íŠ¸
    user.setStatus(UserStatus.SUSPENDED);
    user.setSuspendedUntil(endsAt);
    usersRepository.save(user);
    
    return suspension;
}
```

#### ë§Œë£Œëœ ì´ìš©ì œí•œ ìë™ í•´ì œ
```java
@Transactional
public void releaseExpiredSuspensions() {
    List<UserSanction> expired = sanctionRepository.findExpiredSuspensions(LocalDateTime.now());
    
    for (UserSanction sanction : expired) {
        Users user = sanction.getUser();
        
        // 1. ë‹¤ë¥¸ í™œì„± ì œì¬ê°€ ìˆëŠ”ì§€ í™•ì¸
        List<UserSanction> activeSanctions = sanctionRepository.findActiveSanctionsByUserId(
            user.getIdx(), LocalDateTime.now());
        
        // 2. ì˜êµ¬ ì°¨ë‹¨ì´ ìˆìœ¼ë©´ ê·¸ëŒ€ë¡œ ìœ ì§€
        boolean hasActiveBan = activeSanctions.stream()
            .anyMatch(s -> s.getSanctionType() == UserSanction.SanctionType.BAN);
        
        if (hasActiveBan) {
            continue;
        }
        
        // 3. í™œì„± ì´ìš©ì œí•œì´ ì—†ìœ¼ë©´ í•´ì œ
        boolean hasActiveSuspension = activeSanctions.stream()
            .anyMatch(s -> s.getSanctionType() == UserSanction.SanctionType.SUSPENSION
                && s.getEndsAt() != null && s.getEndsAt().isAfter(LocalDateTime.now()));
        
        if (!hasActiveSuspension) {
            user.setStatus(UserStatus.ACTIVE);
            user.setSuspendedUntil(null);
            usersRepository.save(user);
            log.info("ìœ ì € {} ì´ìš©ì œí•œ ìë™ í•´ì œ", user.getIdx());
        }
    }
}
```

### 3. Report ì—”í‹°í‹°

**ì—­í• **: ì‹ ê³  ë°ì´í„°ë¥¼ ì €ì¥í•˜ëŠ” ì—”í‹°í‹°

**ì£¼ìš” í•„ë“œ**:
- `idx`: ì‹ ê³  ID
- `targetType`: ì‹ ê³  ëŒ€ìƒ íƒ€ì… (`BOARD`, `COMMENT`, `MISSING_PET`, `PET_CARE_PROVIDER`)
- `targetIdx`: ì‹ ê³  ëŒ€ìƒ ID
- `reporter`: ì‹ ê³ ì
- `reason`: ì‹ ê³  ì‚¬ìœ 
- `status`: ì‹ ê³  ìƒíƒœ (`PENDING`, `RESOLVED`, `REJECTED`)
- `handledBy`: ì²˜ë¦¬í•œ ê´€ë¦¬ì
- `handledAt`: ì²˜ë¦¬ ì‹œê°„
- `actionTaken`: ì¡°ì¹˜ íƒ€ì… (`NONE`, `DELETE_CONTENT`, `SUSPEND_USER`, `WARN_USER`, `OTHER`)
- `adminNote`: ê´€ë¦¬ì ë©”ëª¨

**ì—”í‹°í‹° êµ¬ì¡°**:
```java
@Entity
@Table(name = "report", uniqueConstraints = @UniqueConstraint(
    columnNames = { "target_type", "target_idx", "reporter_idx" }))
public class Report {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long idx;
    
    @Enumerated(EnumType.STRING)
    @Column(name = "target_type", nullable = false)
    private ReportTargetType targetType;
    
    @Column(name = "target_idx", nullable = false)
    private Long targetIdx;
    
    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "reporter_idx", nullable = false)
    private Users reporter;
    
    @Column(name = "reason", nullable = false, columnDefinition = "TEXT")
    private String reason;
    
    @Enumerated(EnumType.STRING)
    @Column(name = "status", nullable = false)
    @Builder.Default
    private ReportStatus status = ReportStatus.PENDING;
    
    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "handled_by")
    private Users handledBy;
    
    @Column(name = "handled_at")
    private LocalDateTime handledAt;
    
    @Enumerated(EnumType.STRING)
    @Column(name = "action_taken", nullable = false)
    @Builder.Default
    private ReportActionType actionTaken = ReportActionType.NONE;
    
    @Column(name = "admin_note", columnDefinition = "TEXT")
    private String adminNote;
}
```

**Unique Constraint**: `(target_type, target_idx, reporter_idx)` - ë™ì¼ ì‚¬ìš©ìê°€ ë™ì¼ ëŒ€ìƒì„ ì¤‘ë³µ ì‹ ê³  ë°©ì§€

### 4. UserSanction ì—”í‹°í‹°

**ì—­í• **: ì œì¬ ì´ë ¥ì„ ì €ì¥í•˜ëŠ” ì—”í‹°í‹°

**ì£¼ìš” í•„ë“œ**:
- `idx`: ì œì¬ ID
- `user`: ì œì¬ ëŒ€ìƒ ì‚¬ìš©ì
- `sanctionType`: ì œì¬ íƒ€ì… (`WARNING`, `SUSPENSION`, `BAN`)
- `reason`: ì œì¬ ì‚¬ìœ 
- `durationDays`: ì œì¬ ê¸°ê°„ (ì¼, nullì´ë©´ ì˜êµ¬)
- `startsAt`: ì œì¬ ì‹œì‘ ì‹œê°„
- `endsAt`: ì œì¬ ì¢…ë£Œ ì‹œê°„ (nullì´ë©´ ì˜êµ¬)
- `admin`: ì²˜ë¦¬í•œ ê´€ë¦¬ì
- `reportIdx`: ê´€ë ¨ ì‹ ê³  ID

**ì—”í‹°í‹° êµ¬ì¡°**:
```java
@Entity
@Table(name = "user_sanctions")
public class UserSanction {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long idx;
    
    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "user_idx", nullable = false)
    private Users user;
    
    @Enumerated(EnumType.STRING)
    @Column(nullable = false)
    private SanctionType sanctionType;
    
    @Column(nullable = false, length = 500)
    private String reason;
    
    @Column(name = "duration_days")
    private Integer durationDays; // nullì´ë©´ ì˜êµ¬
    
    @Column(name = "starts_at", nullable = false)
    private LocalDateTime startsAt;
    
    @Column(name = "ends_at")
    private LocalDateTime endsAt; // nullì´ë©´ ì˜êµ¬
    
    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "admin_idx")
    private Users admin;
    
    @Column(name = "report_idx")
    private Long reportIdx;
    
    public enum SanctionType {
        WARNING,      // ê²½ê³ 
        SUSPENSION,   // ì´ìš©ì œí•œ (ì¼ì‹œì )
        BAN          // ì˜êµ¬ ì°¨ë‹¨
    }
    
    /**
     * ì œì¬ê°€ í˜„ì¬ ìœ íš¨í•œì§€ í™•ì¸
     */
    public boolean isActive() {
        if (endsAt == null) {
            // ì˜êµ¬ ì œì¬
            return sanctionType == SanctionType.BAN;
        }
        LocalDateTime now = LocalDateTime.now();
        return now.isAfter(startsAt) && now.isBefore(endsAt);
    }
}
```

### 5. UserSanctionScheduler (ì œì¬ ìŠ¤ì¼€ì¤„ëŸ¬)

**ì—­í• **: ë§Œë£Œëœ ì´ìš©ì œí•œ ìë™ í•´ì œ

**ì£¼ìš” ë©”ì„œë“œ**:
- `releaseExpiredSuspensions()`: ë§¤ì¼ ìì •ì— ì‹¤í–‰ë˜ëŠ” ìŠ¤ì¼€ì¤„ëŸ¬

**í•µì‹¬ ë¡œì§**:
```java
@Scheduled(cron = "0 0 0 * * *") // ë§¤ì¼ ìì •
public void releaseExpiredSuspensions() {
    log.info("ë§Œë£Œëœ ì´ìš©ì œí•œ ìë™ í•´ì œ ì‘ì—… ì‹œì‘");
    try {
        userSanctionService.releaseExpiredSuspensions();
        log.info("ë§Œë£Œëœ ì´ìš©ì œí•œ ìë™ í•´ì œ ì‘ì—… ì™„ë£Œ");
    } catch (Exception e) {
        log.error("ë§Œë£Œëœ ì´ìš©ì œí•œ ìë™ í•´ì œ ì‘ì—… ì‹¤íŒ¨", e);
    }
}
```

## ğŸ“Š ë°ì´í„° íë¦„

### 1. ì‹ ê³  ìƒì„± íë¦„

```mermaid
sequenceDiagram
    participant User as ì‚¬ìš©ì
    participant RC as ReportController
    participant RS as ReportService
    participant RR as ReportRepository
    participant MySQL as MySQL Database
    
    User->>RC: POST /api/reports<br/>(targetType, targetIdx, reason)
    RC->>RS: createReport(request)
    
    RS->>RS: ì…ë ¥ ê²€ì¦<br/>(targetType, targetIdx, reason)
    
    RS->>RR: validateTarget(targetType, targetIdx)
    RR->>MySQL: ëŒ€ìƒ ì¡´ì¬ ì—¬ë¶€ í™•ì¸
    MySQL-->>RR: ëŒ€ìƒ ì¡´ì¬ ì—¬ë¶€
    RR-->>RS: ê²€ì¦ ì™„ë£Œ
    
    RS->>RR: existsByTargetTypeAndTargetIdxAndReporterIdx()
    RR->>MySQL: SELECT COUNT(*) FROM report<br/>WHERE target_type = ?<br/>AND target_idx = ?<br/>AND reporter_idx = ?
    MySQL-->>RR: ì¤‘ë³µ ì—¬ë¶€
    
    alt ì¤‘ë³µ ì‹ ê³ 
        RR-->>RS: true
        RS-->>RC: IllegalStateException<br/>("ì´ë¯¸ í•´ë‹¹ ëŒ€ìƒì„ ì‹ ê³ í•˜ì…¨ìŠµë‹ˆë‹¤.")
    else ì¤‘ë³µ ì—†ìŒ
        RR-->>RS: false
        RS->>RS: Report ì—”í‹°í‹° ìƒì„±<br/>(status = PENDING)
        RS->>RR: save(report)
        RR->>MySQL: INSERT INTO report<br/>(target_type, target_idx, reporter_idx, reason, status)
        MySQL-->>RR: ì €ì¥ ì™„ë£Œ
        RR-->>RS: Report ì—”í‹°í‹°
        RS-->>RC: ReportDTO
        RC-->>User: ì‹ ê³  ìƒì„± ì™„ë£Œ
    end
```

### 2. ì‹ ê³  ì²˜ë¦¬ ë° ì œì¬ ìë™ ì ìš© íë¦„

```mermaid
sequenceDiagram
    participant Admin as ê´€ë¦¬ì
    participant AC as Admin Controller
    participant RS as ReportService
    participant USS as UserSanctionService
    participant RR as ReportRepository
    participant USR as UserSanctionRepository
    participant UR as UsersRepository
    participant MySQL as MySQL Database
    
    Admin->>AC: PUT /api/admin/reports/{id}/handle<br/>(status, actionTaken, adminNote)
    AC->>RS: handleReport(reportId, adminUserId, req)
    
    RS->>RR: findById(reportId)
    RR->>MySQL: SELECT * FROM report WHERE idx = ?
    MySQL-->>RR: Report ì—”í‹°í‹°
    RR-->>RS: Report
    
    RS->>RS: ì‹ ê³  ìƒíƒœ ì—…ë°ì´íŠ¸<br/>(status, handledBy, handledAt, actionTaken, adminNote)
    RS->>RR: save(report)
    RR->>MySQL: UPDATE report SET status = ?, handled_by = ?, ...
    MySQL-->>RR: ì—…ë°ì´íŠ¸ ì™„ë£Œ
    
    alt actionTaken = WARN_USER ë˜ëŠ” SUSPEND_USER
        RS->>USS: applySanctionFromReport(userId, actionType, reason, adminId, reportId)
        
        alt actionType = WARN_USER
            USS->>USR: save(warning)
            USR->>MySQL: INSERT INTO user_sanctions<br/>(user_idx, sanction_type, reason, ...)
            MySQL-->>USR: ì €ì¥ ì™„ë£Œ
            
            USS->>UR: incrementWarningCount(userId)
            UR->>MySQL: UPDATE users SET warning_count = warning_count + 1<br/>WHERE idx = ?
            MySQL-->>UR: ì—…ë°ì´íŠ¸ ì™„ë£Œ (ì›ìì  ì¦ê°€)
            
            USS->>UR: findById(userId)
            UR->>MySQL: SELECT * FROM users WHERE idx = ?
            MySQL-->>UR: Users ì—”í‹°í‹° (ì—…ë°ì´íŠ¸ëœ warningCount)
            UR-->>USS: Users
            
            alt warningCount >= 3
                USS->>USS: addSuspension(userId, reason, adminId, reportId, 3)
                USS->>USR: save(suspension)
                USR->>MySQL: INSERT INTO user_sanctions<br/>(user_idx, sanction_type = SUSPENSION, ...)
                MySQL-->>USR: ì €ì¥ ì™„ë£Œ
                
                USS->>UR: save(user)
                UR->>MySQL: UPDATE users SET status = SUSPENDED,<br/>suspended_until = ?
                MySQL-->>UR: ì—…ë°ì´íŠ¸ ì™„ë£Œ
            end
        else actionType = SUSPEND_USER
            USS->>USS: addBan(userId, reason, adminId, reportId)
            USS->>USR: save(ban)
            USR->>MySQL: INSERT INTO user_sanctions<br/>(user_idx, sanction_type = BAN, ...)
            MySQL-->>USR: ì €ì¥ ì™„ë£Œ
            
            USS->>UR: save(user)
            UR->>MySQL: UPDATE users SET status = BANNED,<br/>suspended_until = NULL
            MySQL-->>UR: ì—…ë°ì´íŠ¸ ì™„ë£Œ
        end
        
        USS-->>RS: ì œì¬ ì ìš© ì™„ë£Œ
    end
    
    RS-->>AC: ReportDTO
    AC-->>Admin: ì‹ ê³  ì²˜ë¦¬ ì™„ë£Œ
```

### 3. ë§Œë£Œëœ ì´ìš©ì œí•œ ìë™ í•´ì œ íë¦„

```mermaid
sequenceDiagram
    participant Scheduler as UserSanctionScheduler
    participant USS as UserSanctionService
    participant USR as UserSanctionRepository
    participant UR as UsersRepository
    participant MySQL as MySQL Database
    
    Note over Scheduler: ë§¤ì¼ ìì • ì‹¤í–‰
    Scheduler->>USS: releaseExpiredSuspensions()
    
    USS->>USR: findExpiredSuspensions(now)
    USR->>MySQL: SELECT * FROM user_sanctions<br/>WHERE sanction_type = 'SUSPENSION'<br/>AND ends_at <= ?
    MySQL-->>USR: ë§Œë£Œëœ ì´ìš©ì œí•œ ëª©ë¡
    USR-->>USS: List<UserSanction>
    
    loop ê° ë§Œë£Œëœ ì´ìš©ì œí•œë§ˆë‹¤
        USS->>USR: findActiveSanctionsByUserId(userId, now)
        USR->>MySQL: SELECT * FROM user_sanctions<br/>WHERE user_idx = ?<br/>AND (ends_at IS NULL OR ends_at > ?)
        MySQL-->>USR: í™œì„± ì œì¬ ëª©ë¡
        USR-->>USS: List<UserSanction>
        
        USS->>USS: ì˜êµ¬ ì°¨ë‹¨(BAN) í™•ì¸
        
        alt ì˜êµ¬ ì°¨ë‹¨ ìˆìŒ
            USS->>USS: í•´ì œ ì•ˆ í•¨ (continue)
        else ì˜êµ¬ ì°¨ë‹¨ ì—†ìŒ
            USS->>USS: í™œì„± ì´ìš©ì œí•œ(SUSPENSION) í™•ì¸
            
            alt í™œì„± ì´ìš©ì œí•œ ì—†ìŒ
                USS->>UR: save(user)
                UR->>MySQL: UPDATE users SET status = ACTIVE,<br/>suspended_until = NULL<br/>WHERE idx = ?
                MySQL-->>UR: ì—…ë°ì´íŠ¸ ì™„ë£Œ
                USS->>USS: ë¡œê·¸ ê¸°ë¡ ("ìœ ì € {} ì´ìš©ì œí•œ ìë™ í•´ì œ")
            else í™œì„± ì´ìš©ì œí•œ ìˆìŒ
                USS->>USS: í•´ì œ ì•ˆ í•¨ (continue)
            end
        end
    end
    
    USS-->>Scheduler: ìë™ í•´ì œ ì™„ë£Œ
```

### 4. ê²½ê³  ëˆ„ì  ë° ìë™ ì´ìš©ì œí•œ íë¦„

```mermaid
sequenceDiagram
    participant Admin1 as ê´€ë¦¬ì 1
    participant Admin2 as ê´€ë¦¬ì 2
    participant Admin3 as ê´€ë¦¬ì 3
    participant USS as UserSanctionService
    participant UR as UsersRepository
    participant MySQL as MySQL Database
    
    Note over Admin1,Admin3: ë™ì‹œì— ê²½ê³  ë¶€ì—¬
    Admin1->>USS: addWarning(userId, reason1, adminId1, reportId1)
    Admin2->>USS: addWarning(userId, reason2, adminId2, reportId2)
    Admin3->>USS: addWarning(userId, reason3, adminId3, reportId3)
    
    par ê²½ê³  1
        USS->>UR: incrementWarningCount(userId)
        UR->>MySQL: UPDATE users SET warning_count = warning_count + 1<br/>WHERE idx = userId
        MySQL-->>UR: warning_count = 1
    and ê²½ê³  2
        USS->>UR: incrementWarningCount(userId)
        UR->>MySQL: UPDATE users SET warning_count = warning_count + 1<br/>WHERE idx = userId
        MySQL-->>UR: warning_count = 2
    and ê²½ê³  3
        USS->>UR: incrementWarningCount(userId)
        UR->>MySQL: UPDATE users SET warning_count = warning_count + 1<br/>WHERE idx = userId
        MySQL-->>UR: warning_count = 3
    end
    
    Note over USS: ê° ê²½ê³  ì²˜ë¦¬ í›„ warningCount í™•ì¸
    
    alt warningCount >= 3 (ê²½ê³  3íšŒ ë„ë‹¬)
        USS->>USS: addSuspension(userId, reason, adminId, reportId, 3)
        USS->>MySQL: INSERT INTO user_sanctions<br/>(user_idx, sanction_type = SUSPENSION, duration_days = 3, ...)
        MySQL-->>USS: ì €ì¥ ì™„ë£Œ
        
        USS->>MySQL: UPDATE users SET status = SUSPENDED,<br/>suspended_until = now + 3ì¼
        MySQL-->>USS: ì—…ë°ì´íŠ¸ ì™„ë£Œ
    end
```

## ğŸ¯ í•µì‹¬ ì„¤ê³„ ì „ëµ

### 1. ë‹¤ì–‘í•œ ì‹ ê³  íƒ€ì… ì§€ì› ì „ëµ

**ë¬¸ì œ**: ê²Œì‹œê¸€, ëŒ“ê¸€, ì‹¤ì¢… ì œë³´, ìœ ì € ë“± ë‹¤ì–‘í•œ ëŒ€ìƒì„ ì‹ ê³ í•´ì•¼ í•¨

**í•´ê²°**: `ReportTargetType` Enumìœ¼ë¡œ íƒ€ì… ë¶„ë¦¬
- `BOARD`: ì»¤ë®¤ë‹ˆí‹° ê²Œì‹œê¸€
- `COMMENT`: ëŒ“ê¸€ (ì¼ë°˜ ëŒ“ê¸€, ì‹¤ì¢… ì œë³´ ëŒ“ê¸€)
- `MISSING_PET`: ì‹¤ì¢… ì œë³´ ê²Œì‹œê¸€
- `PET_CARE_PROVIDER`: í« ì¼€ì–´ ì„œë¹„ìŠ¤ ì œê³µì

**íš¨ê³¼**:
- ìœ ì—°í•œ ì‹ ê³  ì‹œìŠ¤í…œ
- íƒ€ì…ë³„ ê²€ì¦ ë° ì²˜ë¦¬ ê°€ëŠ¥
- í™•ì¥ ê°€ëŠ¥í•œ êµ¬ì¡°

### 2. ì¤‘ë³µ ì‹ ê³  ë°©ì§€ ì „ëµ

**ë¬¸ì œ**: ë™ì¼ ì‚¬ìš©ìê°€ ë™ì¼ ëŒ€ìƒì„ ì—¬ëŸ¬ ë²ˆ ì‹ ê³ í•  ìˆ˜ ìˆìŒ

**í•´ê²°**: DB Unique Constraint
- `(target_type, target_idx, reporter_idx)` Unique Constraint
- ì• í”Œë¦¬ì¼€ì´ì…˜ ë ˆë²¨ì—ì„œë„ ì‚¬ì „ ì²´í¬ (`existsByTargetTypeAndTargetIdxAndReporterIdx`)

**íš¨ê³¼**:
- ì¤‘ë³µ ì‹ ê³  ë°©ì§€
- ë°ì´í„° ì¼ê´€ì„± ë³´ì¥
- DB ë ˆë²¨ ë³´í˜¸

### 3. ìë™ ì œì¬ ì‹œìŠ¤í…œ ì „ëµ

**ë¬¸ì œ**: ê²½ê³ ê°€ ëˆ„ì ë˜ë©´ ìë™ìœ¼ë¡œ ì œì¬ë¥¼ ì ìš©í•´ì•¼ í•¨

**í•´ê²°**: ê²½ê³  ì¶”ê°€ ì‹œ ìë™ ì²´í¬ ë° ì œì¬ ì ìš©
- ê²½ê³  ì¶”ê°€ í›„ `warningCount` í™•ì¸
- `warningCount >= 3`ì´ë©´ ìë™ ì´ìš©ì œí•œ 3ì¼ ì ìš©
- ì œì¬ ì´ë ¥ì— ìë™ ì œì¬ ê¸°ë¡

**íš¨ê³¼**:
- ì¼ê´€ëœ ì œì¬ ì •ì±… ì ìš©
- ê´€ë¦¬ì ê°œì… ìµœì†Œí™”
- ê³µì •í•œ ì œì¬ ì‹œìŠ¤í…œ

### 4. ë™ì‹œì„± ì œì–´ ì „ëµ

**ë¬¸ì œ**: ì—¬ëŸ¬ ê´€ë¦¬ìê°€ ë™ì‹œì— ê°™ì€ ì‚¬ìš©ìì—ê²Œ ê²½ê³ ë¥¼ ë¶€ì—¬í•˜ë©´ ê²½ê³  íšŸìˆ˜ê°€ ë¶€ì •í™•í•  ìˆ˜ ìˆìŒ

**í•´ê²°**: DB ë ˆë²¨ ì›ìì  ì¦ê°€ ì¿¼ë¦¬
- `@Modifying @Query`ë¡œ `UPDATE users SET warning_count = warning_count + 1`
- DB ë ˆë²¨ì—ì„œ ì›ìì  ì¦ê°€ ë³´ì¥
- íŠ¸ëœì­ì…˜ ë‚´ì—ì„œ ì‹¤í–‰

**íš¨ê³¼**:
- ì •í™•í•œ ê²½ê³  íšŸìˆ˜ ë³´ì¥
- ë™ì‹œì„± ë¬¸ì œ í•´ê²°
- Race condition ë°©ì§€

### 5. ì œì¬ ì´ë ¥ ê´€ë¦¬ ì „ëµ

**ë¬¸ì œ**: ëª¨ë“  ì œì¬ ì´ë ¥ì„ ì¶”ì í•˜ê³  ê´€ë¦¬í•´ì•¼ í•¨

**í•´ê²°**: `UserSanction` í…Œì´ë¸”ì— ëª¨ë“  ì œì¬ ê¸°ë¡
- ì œì¬ íƒ€ì…, ì‚¬ìœ , ê¸°ê°„, ê´€ë¦¬ì, ê´€ë ¨ ì‹ ê³  ID ì €ì¥
- ì œì¬ í•´ì œ ì‹œì—ë„ ì´ë ¥ ìœ ì§€
- ì œì¬ ìœ íš¨ì„± í™•ì¸ ë©”ì„œë“œ ì œê³µ (`isActive()`)

**íš¨ê³¼**:
- ì™„ì „í•œ ì œì¬ ì´ë ¥ ì¶”ì 
- íˆ¬ëª…í•œ ì œì¬ ê´€ë¦¬
- ê°ì‚¬(Audit) ê°€ëŠ¥

### 6. ìë™ í•´ì œ ì „ëµ

**ë¬¸ì œ**: ë§Œë£Œëœ ì´ìš©ì œí•œì„ ìˆ˜ë™ìœ¼ë¡œ í•´ì œí•˜ëŠ” ê²ƒì€ ë²ˆê±°ë¡œì›€

**í•´ê²°**: ìŠ¤ì¼€ì¤„ëŸ¬ë¥¼ í†µí•œ ìë™ í•´ì œ
- ë§¤ì¼ ìì •ì— ë§Œë£Œëœ ì´ìš©ì œí•œ ì¡°íšŒ
- ë‹¤ë¥¸ í™œì„± ì œì¬ê°€ ì—†ìœ¼ë©´ ìë™ í•´ì œ
- ì˜êµ¬ ì°¨ë‹¨ì€ í•´ì œí•˜ì§€ ì•ŠìŒ

**íš¨ê³¼**:
- ê´€ë¦¬ ë¶€ë‹´ ê°ì†Œ
- ì •í™•í•œ ì œì¬ ê¸°ê°„ ê´€ë¦¬
- ì‚¬ìš©ì ê²½í—˜ í–¥ìƒ

### 7. ì œì¬ ìš°ì„ ìˆœìœ„ ì „ëµ

**ë¬¸ì œ**: ì—¬ëŸ¬ ì œì¬ê°€ ë™ì‹œì— ì ìš©ë  ìˆ˜ ìˆìŒ

**í•´ê²°**: ì œì¬ ìš°ì„ ìˆœìœ„ ê´€ë¦¬
- ì˜êµ¬ ì°¨ë‹¨(BAN) > ì´ìš©ì œí•œ(SUSPENSION) > ê²½ê³ (WARNING)
- ì˜êµ¬ ì°¨ë‹¨ì´ ìˆìœ¼ë©´ ë‹¤ë¥¸ ì œì¬ í•´ì œ ì•ˆ í•¨
- í™œì„± ì´ìš©ì œí•œì´ ìˆìœ¼ë©´ ìƒíƒœ ìœ ì§€

**íš¨ê³¼**:
- ëª…í™•í•œ ì œì¬ ìš°ì„ ìˆœìœ„
- ì¼ê´€ëœ ì œì¬ ìƒíƒœ ê´€ë¦¬

## ğŸ”„ ë„ë©”ì¸ ê°„ ì—°ë™

### 1. Board ë„ë©”ì¸ ì—°ë™
- **ì‹ ê³  ëŒ€ìƒ**: ê²Œì‹œê¸€ (`BOARD`)
- **ê²€ì¦**: `BoardRepository.existsById()`
- **ë¯¸ë¦¬ë³´ê¸°**: ê²Œì‹œê¸€ ì œëª©, ë‚´ìš©, ì‘ì„±ì ì •ë³´

### 2. Comment ë„ë©”ì¸ ì—°ë™
- **ì‹ ê³  ëŒ€ìƒ**: ëŒ“ê¸€ (`COMMENT`)
- **ê²€ì¦**: `CommentRepository.existsById()` ë˜ëŠ” `MissingPetCommentRepository.existsById()`
- **ë¯¸ë¦¬ë³´ê¸°**: ëŒ“ê¸€ ë‚´ìš©, ì‘ì„±ì ì •ë³´

### 3. MissingPet ë„ë©”ì¸ ì—°ë™
- **ì‹ ê³  ëŒ€ìƒ**: ì‹¤ì¢… ì œë³´ ê²Œì‹œê¸€ (`MISSING_PET`)
- **ê²€ì¦**: `MissingPetBoardRepository.existsById()`
- **ë¯¸ë¦¬ë³´ê¸°**: ì‹¤ì¢… ì œë³´ ì œëª©, ë‚´ìš©, ì‘ì„±ì ì •ë³´

### 4. User ë„ë©”ì¸ ì—°ë™
- **ì‹ ê³  ëŒ€ìƒ**: ì„œë¹„ìŠ¤ ì œê³µì (`PET_CARE_PROVIDER`)
- **ê²€ì¦**: `UsersRepository.findById()` ë° `Role.SERVICE_PROVIDER` í™•ì¸
- **ì œì¬ ì ìš©**: `Users.status`, `Users.warningCount`, `Users.suspendedUntil` ì—…ë°ì´íŠ¸

## ğŸ“ˆ ì„±ëŠ¥ ìµœì í™”

### 1. DB ìµœì í™”

#### ì¸ë±ìŠ¤ ì „ëµ
```sql
-- ì‹ ê³  ì¡°íšŒ ìµœì í™”
CREATE INDEX idx_report_target ON report(target_type, target_idx);
CREATE INDEX idx_report_status ON report(status, created_at DESC);
CREATE INDEX idx_report_reporter ON report(reporter_idx, created_at DESC);

-- ì œì¬ ì¡°íšŒ ìµœì í™”
CREATE INDEX idx_user_sanctions_user ON user_sanctions(user_idx, created_at DESC);
CREATE INDEX idx_user_sanctions_expired ON user_sanctions(sanction_type, ends_at) 
WHERE sanction_type = 'SUSPENSION' AND ends_at IS NOT NULL;

-- ì‚¬ìš©ì ì œì¬ ìƒíƒœ ì¡°íšŒ ìµœì í™”
CREATE INDEX idx_users_status ON users(status, suspended_until);
```

**ì„ ì • ì´ìœ **:
- ì‹ ê³  ëª©ë¡ ì¡°íšŒ ì„±ëŠ¥ í–¥ìƒ
- ì œì¬ ì´ë ¥ ì¡°íšŒ ìµœì í™”
- ë§Œë£Œëœ ì œì¬ ì¡°íšŒ ìµœì í™”

### 2. ì• í”Œë¦¬ì¼€ì´ì…˜ ë ˆë²¨ ìµœì í™”

#### ì›ìì  ì¦ê°€ ì¿¼ë¦¬
- **DB ë ˆë²¨ ì¦ê°€**: `UPDATE users SET warning_count = warning_count + 1`
- **ë™ì‹œì„± ì•ˆì „**: ì—¬ëŸ¬ ìš”ì²­ì´ ë™ì‹œì— ë“¤ì–´ì™€ë„ ì •í™•í•œ ì¦ê°€

#### íŠ¸ëœì­ì…˜ ê´€ë¦¬
- `@Transactional`ë¡œ ë°ì´í„° ì¼ê´€ì„± ë³´ì¥
- ì œì¬ ì ìš© ì‹œ ì›ìì  ì²˜ë¦¬

#### ìŠ¤ì¼€ì¤„ëŸ¬ ìµœì í™”
- ë§¤ì¼ ìì •ì— í•œ ë²ˆë§Œ ì‹¤í–‰
- ë§Œë£Œëœ ì œì¬ë§Œ ì¡°íšŒí•˜ì—¬ íš¨ìœ¨ì„± í–¥ìƒ

## ğŸ” ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

### 1. ê¶Œí•œ ì œì–´
- **ì‹ ê³  ìƒì„±**: ì¸ì¦ëœ ì‚¬ìš©ìë§Œ ê°€ëŠ¥ (`@PreAuthorize("isAuthenticated()")`)
- **ì‹ ê³  ì²˜ë¦¬**: ê´€ë¦¬ìë§Œ ê°€ëŠ¥ (`@PreAuthorize("hasAnyRole('ADMIN','MASTER')")`)
- **ì œì¬ ì ìš©**: ê´€ë¦¬ìë§Œ ê°€ëŠ¥

### 2. ë°ì´í„° ê²€ì¦
- **ì‹ ê³  ëŒ€ìƒ ê²€ì¦**: ëŒ€ìƒ ì¡´ì¬ ì—¬ë¶€ í™•ì¸
- **ì¤‘ë³µ ì‹ ê³  ë°©ì§€**: DB Unique Constraint + ì• í”Œë¦¬ì¼€ì´ì…˜ ë ˆë²¨ ì²´í¬
- **ì œì¬ ì‚¬ìœ  ê²€ì¦**: í•„ìˆ˜ ì…ë ¥ í™•ì¸

### 3. ì…ë ¥ ê²€ì¦
- SQL Injection ë°©ì§€ (JPA ì‚¬ìš©)
- XSS ë°©ì§€ (DTO ë³€í™˜ ì‹œ ì´ìŠ¤ì¼€ì´í”„)
- ì‹ ê³  ì‚¬ìœ  ê¸¸ì´ ì œí•œ

## ğŸ“ ì£¼ìš” API ì—”ë“œí¬ì¸íŠ¸

### ì‹ ê³  ìƒì„±
```
POST /api/reports
â†’ ReportDTO
- targetType: BOARD, COMMENT, MISSING_PET, PET_CARE_PROVIDER
- targetIdx: ì‹ ê³  ëŒ€ìƒ ID
- reason: ì‹ ê³  ì‚¬ìœ 
- ì¤‘ë³µ ì‹ ê³  ë°©ì§€
```

### ì‹ ê³  ëª©ë¡ ì¡°íšŒ
```
GET /api/admin/reports?targetType={type}&status={status}
â†’ List<ReportDTO>
- ê´€ë¦¬ìë§Œ ì ‘ê·¼ ê°€ëŠ¥
- í•„í„°ë§ ì§€ì› (targetType, status)
```

### ì‹ ê³  ìƒì„¸ ì¡°íšŒ
```
GET /api/admin/reports/{id}
â†’ ReportDetailDTO
- ê´€ë¦¬ìë§Œ ì ‘ê·¼ ê°€ëŠ¥
- ëŒ€ìƒ ë¯¸ë¦¬ë³´ê¸° í¬í•¨
```

### ì‹ ê³  ì²˜ë¦¬
```
PUT /api/admin/reports/{id}/handle
â†’ ReportDTO
- ê´€ë¦¬ìë§Œ ì ‘ê·¼ ê°€ëŠ¥
- status: PENDING, RESOLVED, REJECTED
- actionTaken: NONE, DELETE_CONTENT, SUSPEND_USER, WARN_USER, OTHER
- ì œì¬ ìë™ ì ìš©
```

### ì œì¬ ì´ë ¥ ì¡°íšŒ
```
GET /api/admin/users/{id}/sanctions
â†’ List<UserSanction>
- ê´€ë¦¬ìë§Œ ì ‘ê·¼ ê°€ëŠ¥
- ì‚¬ìš©ìì˜ ëª¨ë“  ì œì¬ ì´ë ¥
```

## ğŸ¯ í•µì‹¬ í¬ì¸íŠ¸ ìš”ì•½

### 1. ë‹¤ì–‘í•œ ì‹ ê³  íƒ€ì…
- **BOARD**: ì»¤ë®¤ë‹ˆí‹° ê²Œì‹œê¸€
- **COMMENT**: ëŒ“ê¸€
- **MISSING_PET**: ì‹¤ì¢… ì œë³´ ê²Œì‹œê¸€
- **PET_CARE_PROVIDER**: ì„œë¹„ìŠ¤ ì œê³µì

### 2. ìë™ ì œì¬ ì‹œìŠ¤í…œ
- **ê²½ê³  ëˆ„ì **: ê²½ê³  3íšŒ ëˆ„ì  ì‹œ ìë™ ì´ìš©ì œí•œ 3ì¼ ì ìš©
- **ìë™ ì ìš©**: ì‹ ê³  ì²˜ë¦¬ ì‹œ ì œì¬ ìë™ ì ìš©
- **ìë™ í•´ì œ**: ìŠ¤ì¼€ì¤„ëŸ¬ë¥¼ í†µí•œ ë§Œë£Œëœ ì´ìš©ì œí•œ ìë™ í•´ì œ

### 3. ê´€ë¦¬ì ìˆ˜ë™ ì œì¬
- **ê²½ê³ **: ê²½ê³  ì¶”ê°€ (ëˆ„ì )
- **ì´ìš©ì œí•œ**: ì¼ì‹œì  ì´ìš©ì œí•œ (ê¸°ê°„ ì§€ì •)
- **ì˜êµ¬ ì°¨ë‹¨**: ì˜êµ¬ ì°¨ë‹¨

### 4. ì œì¬ ì´ë ¥ ê´€ë¦¬
- **ëª¨ë“  ì œì¬ ê¸°ë¡**: `UserSanction` í…Œì´ë¸”ì— ëª¨ë“  ì œì¬ ì´ë ¥ ì €ì¥
- **ì œì¬ ìœ íš¨ì„± í™•ì¸**: `isActive()` ë©”ì„œë“œë¡œ í˜„ì¬ ìœ íš¨í•œ ì œì¬ í™•ì¸
- **ê´€ë ¨ ì‹ ê³  ì¶”ì **: `reportIdx`ë¡œ ê´€ë ¨ ì‹ ê³  ì¶”ì 

### 5. ë™ì‹œì„± ì œì–´
- **ì›ìì  ì¦ê°€**: DB ë ˆë²¨ `UPDATE users SET warning_count = warning_count + 1`
- **ì •í™•í•œ ê²½ê³  íšŸìˆ˜**: ì—¬ëŸ¬ ê´€ë¦¬ìê°€ ë™ì‹œì— ê²½ê³ ë¥¼ ë¶€ì—¬í•´ë„ ì •í™•í•œ íšŸìˆ˜ ë³´ì¥
- **Race condition ë°©ì§€**: íŠ¸ëœì­ì…˜ ë‚´ì—ì„œ ì›ìì  ì²˜ë¦¬

### 6. ìë™ í•´ì œ
- **ìŠ¤ì¼€ì¤„ëŸ¬**: ë§¤ì¼ ìì •ì— ë§Œë£Œëœ ì´ìš©ì œí•œ ìë™ í•´ì œ
- **ì¡°ê±´ë¶€ í•´ì œ**: ë‹¤ë¥¸ í™œì„± ì œì¬ê°€ ì—†ì„ ë•Œë§Œ í•´ì œ
- **ì˜êµ¬ ì°¨ë‹¨ ë³´í˜¸**: ì˜êµ¬ ì°¨ë‹¨ì€ í•´ì œí•˜ì§€ ì•ŠìŒ

### 7. ì œì¬ ìš°ì„ ìˆœìœ„
- **ì˜êµ¬ ì°¨ë‹¨ > ì´ìš©ì œí•œ > ê²½ê³ **: ëª…í™•í•œ ìš°ì„ ìˆœìœ„
- **ìƒíƒœ ê´€ë¦¬**: ê°€ì¥ ë†’ì€ ìš°ì„ ìˆœìœ„ ì œì¬ë¡œ ì‚¬ìš©ì ìƒíƒœ ê²°ì •
